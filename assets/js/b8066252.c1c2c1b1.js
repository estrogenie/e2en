"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[4122],{75184:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"lifecycle","title":"Lifecycle","description":"e2en provides hooks for player and character lifecycle events with automatic cleanup through Troves.","source":"@site/docs/lifecycle.md","sourceDirName":".","slug":"/lifecycle","permalink":"/e2en/docs/lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/estrogenie/e2en/edit/master/docs/lifecycle.md","tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"defaultSidebar","previous":{"title":"Communication","permalink":"/e2en/docs/communication"},"next":{"title":"Components","permalink":"/e2en/docs/components"}}');var t=a(74848),l=a(28453);const c={sidebar_position:6},i="Lifecycle",d={},o=[{value:"Server Lifecycle",id:"server-lifecycle",level:2},{value:"Player Added",id:"player-added",level:3},{value:"Player Removing",id:"player-removing",level:3},{value:"Character Added",id:"character-added",level:3},{value:"Character Removing",id:"character-removing",level:3},{value:"Getting Troves Manually",id:"getting-troves-manually",level:3},{value:"Client Lifecycle",id:"client-lifecycle",level:2},{value:"Character Added",id:"character-added-1",level:3},{value:"Character Removing",id:"character-removing-1",level:3},{value:"Getting Current Character",id:"getting-current-character",level:3},{value:"Player Reference",id:"player-reference",level:3},{value:"The Trove Pattern",id:"the-trove-pattern",level:2},{value:"Adding Objects",id:"adding-objects",level:3},{value:"Nested Troves",id:"nested-troves",level:3},{value:"Lifecycle Timing",id:"lifecycle-timing",level:2},{value:"Common Patterns",id:"common-patterns",level:2},{value:"Per-Player State",id:"per-player-state",level:3},{value:"Character Components",id:"character-components",level:3},{value:"Waiting for Character",id:"waiting-for-character",level:3},{value:"Client: Waiting for Server",id:"client-waiting-for-server",level:3}];function s(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lifecycle",children:"Lifecycle"})}),"\n",(0,t.jsx)(n.p,{children:"e2en provides hooks for player and character lifecycle events with automatic cleanup through Troves."}),"\n",(0,t.jsx)(n.h2,{id:"server-lifecycle",children:"Server Lifecycle"}),"\n",(0,t.jsx)(n.h3,{id:"player-added",children:"Player Added"}),"\n",(0,t.jsx)(n.p,{children:"Called when a player joins. Also fires retroactively for players already in the game."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnPlayerAdded(function(player: Player, trove: Trove)\n    print(player.Name, "joined")\n\n    -- Load their data\n    local data = loadData(player)\n\n    -- Add things to the trove for auto-cleanup\n    trove:Add(createPlayerState(player))\n\n    trove:Connect(player.Chatted, function(message)\n        print(player.Name, "said:", message)\n    end)\nend)\n'})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"trove"})," automatically cleans up when the player leaves\u2014no manual disconnection needed."]}),"\n",(0,t.jsx)(n.h3,{id:"player-removing",children:"Player Removing"}),"\n",(0,t.jsx)(n.p,{children:"Called when a player is about to leave. Use this for saving data."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnPlayerRemoving(function(player: Player)\n    print(player.Name, "leaving")\n    saveData(player)\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"character-added",children:"Character Added"}),"\n",(0,t.jsx)(n.p,{children:"Called when a character spawns. Also fires retroactively for existing characters."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnCharacterAdded(function(player: Player, character: Model, trove: Trove)\n    print(player.Name, "spawned")\n\n    local humanoid = character:WaitForChild("Humanoid") :: Humanoid\n\n    -- Auto-cleanup when character dies/respawns\n    trove:Connect(humanoid.Died, function()\n        print(player.Name, "died")\n    end)\n\n    trove:Connect(humanoid.Running, function(speed)\n        if speed > 0 then\n            print(player.Name, "is running")\n        end\n    end)\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"character-removing",children:"Character Removing"}),"\n",(0,t.jsx)(n.p,{children:"Called when a character is about to be removed."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnCharacterRemoving(function(player: Player, character: Model)\n    print(player.Name, "character removing")\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getting-troves-manually",children:"Getting Troves Manually"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"local playerTrove = e2en.GetPlayerTrove(player)\nlocal characterTrove = e2en.GetCharacterTrove(player)\n\nif playerTrove then\n    playerTrove:Add(someCleanupTarget)\nend\n"})}),"\n",(0,t.jsx)(n.h2,{id:"client-lifecycle",children:"Client Lifecycle"}),"\n",(0,t.jsx)(n.h3,{id:"character-added-1",children:"Character Added"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnCharacterAdded(function(character: Model, trove: Trove)\n    print("Spawned")\n\n    local humanoid = character:WaitForChild("Humanoid") :: Humanoid\n\n    trove:Connect(humanoid.Died, function()\n        print("Died")\n    end)\n\n    trove:Connect(humanoid.HealthChanged, function(health)\n        updateHealthBar(health)\n    end)\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"character-removing-1",children:"Character Removing"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnCharacterRemoving(function(character: Model)\n    print("Character removing")\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"getting-current-character",children:"Getting Current Character"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- Returns nil if no character exists\nlocal character = e2en.GetCharacter()\n\n-- Get the character's trove (nil if no character)\nlocal trove = e2en.GetCharacterTrove()\n"})}),"\n",(0,t.jsx)(n.h3,{id:"player-reference",children:"Player Reference"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'local player = e2en.Player\nprint("I am", player.Name)\n'})}),"\n",(0,t.jsx)(n.h2,{id:"the-trove-pattern",children:"The Trove Pattern"}),"\n",(0,t.jsx)(n.p,{children:"Troves manage cleanup automatically. When a trove is cleaned (player leaves, character dies), everything added to it is destroyed/disconnected."}),"\n",(0,t.jsx)(n.h3,{id:"adding-objects",children:"Adding Objects"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnPlayerAdded(function(player, trove)\n    -- Instances are destroyed\n    local folder = Instance.new("Folder")\n    folder.Name = player.Name\n    trove:Add(folder)\n    folder.Parent = workspace\n\n    -- Connections are disconnected\n    trove:Connect(player.Chatted, function(msg)\n        print(msg)\n    end)\n\n    -- Tables with Destroy method\n    local state = { Destroy = function() print("cleaned up") end }\n    trove:Add(state)\n\n    -- Custom cleanup method\n    local resource = createResource()\n    trove:Add(resource, "Release") -- calls resource:Release()\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"nested-troves",children:"Nested Troves"}),"\n",(0,t.jsx)(n.p,{children:"Create sub-troves for grouped cleanup:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"e2en.OnCharacterAdded(function(player, character, trove)\n    -- Combat-related stuff\n    local combatTrove = Trove.new()\n    trove:Add(combatTrove)\n\n    combatTrove:Connect(...)\n    combatTrove:Add(...)\n\n    -- Clear combat stuff without clearing everything\n    combatTrove:Clean()\nend)\n"})}),"\n",(0,t.jsx)(n.h2,{id:"lifecycle-timing",children:"Lifecycle Timing"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                     SERVER TIMELINE                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                                             \u2502\n\u2502  Player Joins                                               \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                           \u2502\n\u2502  \u2502 PlayerAdded \u2502 \u2500\u2500\u2500 playerTrove created                   \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                           \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                        \u2502\n\u2502  \u2502 CharacterAdded \u2502 \u2500\u2500\u2500 characterTrove created             \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                        \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u2502  (player plays...)                                  \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                     \u2502\n\u2502  \u2502 CharacterRemoving \u2502                                     \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                     \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  characterTrove:Clean() \u2500\u2500\u2500 automatic                      \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u2502  (respawn...)                                       \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                        \u2502\n\u2502  \u2502 CharacterAdded \u2502 \u2500\u2500\u2500 new characterTrove                 \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                        \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u2502  (player leaves...)                                 \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                                        \u2502\n\u2502  \u2502 PlayerRemoving \u2502                                        \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                                        \u2502\n\u2502       \u2502                                                     \u2502\n\u2502       \u25bc                                                     \u2502\n\u2502  playerTrove:Clean() \u2500\u2500\u2500 automatic                         \u2502\n\u2502                                                             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-patterns",children:"Common Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"per-player-state",children:"Per-Player State"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"local playerStates = {}\n\ne2en.OnPlayerAdded(function(player, trove)\n    playerStates[player] = {\n        score = 0,\n        inventory = {},\n    }\nend)\n\ne2en.OnPlayerRemoving(function(player)\n    playerStates[player] = nil\nend)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"character-components",children:"Character Components"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'e2en.OnCharacterAdded(function(player, character, trove)\n    -- Add a highlight that auto-removes on death\n    local highlight = Instance.new("Highlight")\n    highlight.FillColor = Color3.new(1, 0, 0)\n    trove:Add(highlight)\n    highlight.Parent = character\n\n    -- Track running state\n    local humanoid = character:WaitForChild("Humanoid") :: Humanoid\n    local isRunning = false\n\n    trove:Connect(humanoid.Running, function(speed)\n        isRunning = speed > 0\n    end)\nend)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"waiting-for-character",children:"Waiting for Character"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"function MyService:DoSomethingWithCharacter(player: Player)\n    local character = player.Character\n    if not character then\n        character = player.CharacterAdded:Wait()\n    end\n    -- Now we have a character\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"client-waiting-for-server",children:"Client: Waiting for Server"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'function MyController:Start()\n    -- Wait for framework to be fully ready\n    e2en.OnStart()\n\n    -- Now safe to access services\n    local GameService = e2en.GetService("GameService")\nend\n'})})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(s,{...e})}):s(e)}},28453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>i});var r=a(96540);const t={},l=r.createContext(t);function c(e){const n=r.useContext(l);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:c(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);